{
    "variables": {
        "hostname": "alpine",
        "password": "alpine",
        "disk_size": "512",
        "id_rsa.pub": "{{env `HOME`}}/.ssh/id_rsa.pub",
        "vnc_port_max": "6000"
    },
    "builders":
    [
    {
    "type": "qemu",
    "accelerator": "kvm",
    "iso_url": "http://dl-cdn.alpinelinux.org/alpine/v3.8/releases/x86_64/alpine-virt-3.8.1-x86_64.iso",
    "iso_checksum": "83ede521b174d99a0975c3653e7310b58075fa68fb773ed6995b974a44df60ce",
    "iso_checksum_type": "sha256",
    "output_directory": "iso",
    "shutdown_command": "poweroff",
    "disk_size": "{{user `disk_size`}}",
    "format": "raw",
    "headless": true,
    "ssh_host_port_min": 2222,
    "ssh_host_port_max": 2229,
    "ssh_username": "root",
    "ssh_password": "{{user `password`}}",
    "ssh_port": 22,
    "ssh_wait_timeout": "16s",
    "vm_name": "alpine-3.8.1-x86_64.iso",
    "vnc_port_max": "{{user `vnc_port_max`}}",
    "net_device": "virtio-net",
    "disk_interface": "virtio",
    "boot_wait": "8s",
    "boot_command":
    [
        "<wait5>",
        "root<enter>",
        "passwd<enter>{{user `password`}}<enter>{{user `password`}}<enter>",
        "apk add openssh<enter>",
        "echo 'PermitRootLogin yes' >> /etc/ssh/sshd_config<enter>",
        "ifconfig eth0 up && udhcpc -i eth0<enter>",
        "/etc/init.d/sshd start<enter>"
    ]
    }
    ],    "provisioners": [
    {
        "type": "shell",
        "script": "alpine/setup.sh",
        "environment_vars": ["PASSWORD={{user `password`}}",
                             "HOSTNAME={{user `hostname`}}"]
    },
    {
        "type": "shell",
        "inline": ["mount /dev/vda2 /mnt",
                   "mkdir -p /mnt/root/.ssh",
                   "chmod 0700 /mnt/root/.ssh"]
    },
    {
        "type": "file",
        "source": "{{user `id_rsa.pub`}}",
        "destination": "/mnt/root/.ssh/authorized_keys"
    },
    {
        "type": "shell",
        "inline": ["umount /mnt"]
    }
    ]
}
